<!DOCTYPE html>
<html>
<link rel="stylesheet" type="text/css" href="common.css">
<link rel="stylesheet" type="text/css" href="timeleap.css">

<script src="script/jquery.min.js"></script>
<script src="script/chart.js@2.8.0"></script>

<body>
    <div style="margin:auto; position: relative; width:1920px; height:80px;">
        <div id="time-stamp"></div>
        <svg id="under-line" width="1920" height="42">
            <polyline class="under-line-style" points="0 40 760 40 791 0" />
            <polyline class="under-line-style" points="1920 40 1160 40 1129 0" />
        </svg>
        <svg id="center-top" width="400" height="80">
            <path
                d="M12.5,0H0L57,76a10,10,0,0,0,8,4H335a10,10,0,0,0,8-4L400,0H387.5L338,66a10,10,0,0,1-8,4H70a10,10,0,0,1-8-4Z"
                style="fill:#f3f3f3" />
        </svg>
        <div id="raon-box"><a href="main.html"><img width="133.7666" height="33.8293" src="images/raon-white.svg"></a>
        </div>
        <div id="accelerator-control"><a href="member.html">C</a><a href="bab.html">S</a></div>
        <div id="left-menu">
            <a href="" class="secret-menu">Logbook</a>
            <a href="" class="secret-menu">Finder</a>
            <a href="" class="secret-menu">Naming</a>
            <a href="download.html">Download</a>
            <a href="document.html">Document</a>
        </div>
        <div id="right-menu">
            <a href="monitoring.html">Monitoring</a>
            <a href="schedule.html">Dobby</a>
            <a href="archive.html">Archive</a>
            <a href="timeleap.html">PlanB</a>
            <a href="asset.html">Asset</a>
        </div>
    </div>

    <div style="height:20px"></div>

    <div id="snapshot-list-body">
        <div style="position:relative; width:800px; margin:auto; margin-top: 20px;">
            <div class="title-box" style="display: inline-block; margin:auto; left:0px;">
                Snapshot List</div>
            <div id="snapshot-list-button">
                <button class="snapshot-list-config-button" onclick="compareSnapshot()">Compare</button>
                <button class="snapshot-list-config-button"
                    onclick="document.getElementById('snapshot-list-body').style.display='none'"
                    id="close">Close</button>
            </div>
        </div>

        <table id="snapshot-compare-table"
            style="position: relative; margin: auto; box-shadow: 0 15px 50px rgba(0, 0, 0, 1.0);">
            <thead id="snapshot-compare-tableHead" style="font-family: Roboto-Light"></thead>
            <tbody id="snapshot-compare-tableBody"></tbody>
        </table>
    </div>

    <div style="width:1920px; height:780px; display:flex; margin:auto;">

        <!-- Left -->
        <div id="body-left">
            <div class="title-box" style="display: inline-block;">Time Leap</div>
            <div id="event-button-container">
                <!-- <button class="event-config-button" onclick="createNewEventSet()">New</button> -->
                <!-- <button class="event-config-button" onclick="showSnapshotCompareTable()">Compare</button> -->
                <svg id="snapshot-compare-button" width="25.5" height="25.5" onclick="showSnapshotCompareTable()">
                    <polygon points="7.5 7.5 15 7.5 15 0 0 0 0 15 7.5 15 7.5 7.5" style="fill: #e6e6e6" />
                    <rect x="10" y="10" width="15" height="15"
                        style="fill: none;stroke: #e6e6e6;stroke-miterlimit: 10" />
                </svg>
            </div>

            <div style="display: flex; position:relative; left: 25px; margin-top:10px">
                <button id="last-button" onclick="createCalendar(-1)">&#10094;</button>

                <div id="year">January 2021</div>
                <button id="next-button" onclick="createCalendar(1)">&#10095;</button>
            </div>

            <div style="display: flex;">
                <div class="week">SUN</div>
                <div class="week">MON</div>
                <div class="week">TUE</div>
                <div class="week">WED</div>
                <div class="week">THU</div>
                <div class="week">FRI</div>
                <div class="week">SAT</div>
            </div>

            <div id="calendar">
                <!-- 1 week -->
                <div class="day" style="z-index: 2;">
                    <div class="today"></div>
                </div>
                <div class="day" style="z-index: 1;">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>

                <!-- 2 week -->
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>

                <!-- 3 week -->
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>

                <!-- 4 week -->
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>

                <!-- 5 week -->
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>

                <!-- 6 week -->
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
                <div class="day">
                    <div class="today"></div>
                </div>
            </div>

            <div style="height:20px"></div>

            <div id="compare-chart-container">
                <canvas id="compare-chart" style="width:700px; height:200px"></canvas>
            </div>
        </div>

        <!-- Center -->
        <div id="body-center">

        </div>

        <!-- Right -->
        <div id="body-right">
            <div class="title-box" id="snapshot-id" style="display: inline-block;"></div>

            <!-- Record List Table -->
            <div id="record-table-button">
                <button class="record-config-button">Update</button>
                <button class="record-config-button">Get</button>
                <button class="record-config-button" onclick="putSnapshotRecord()">Put</button>
                <button class="record-config-button" onclick="importRecordFile()">Import</button>
                <button class="record-config-button" onclick="exportRecordFile()">Export</button>
            </div>
            <table id="record-table">
                <thead id="record-tableHead" style="font-family: Roboto-Light"></thead>
                <tbody id="record-tableBody"></tbody>
            </table>

            <!-- Compare Record Table -->
            <table id="compare-table" style="display: none;">
                <thead id="compare-tableHead" style="font-family: Roboto-Light"></thead>
                <tbody id="compare-tableBody"></tbody>
            </table>
        </div>
    </div>


</body>

<script>
    // ctrluser Server
    var serverAddr = 'http://192.168.68.126:9013/timeleap';

    // scwook Server
    // var serverAddr = 'http://localhost:9013/timeleap';

    var newEventAddr = serverAddr + '/event';
    var newSnapshotAddr = serverAddr + '/snapshot';
    var newRecordConnectionAddr = serverAddr + '/snapshot/connection';

    var putRecordAddr = serverAddr + '/snapshot/put';

    var retrieveAddr = serverAddr + '/retrieve';
    var retrieveEventAddr = serverAddr + '/retrieve/event';
    var retrieveSnapshotAddr = serverAddr + '/retrieve/snapshot'
    var retrieveSnapshotRecordAddr = serverAddr + '/retrieve/snapshot/record'
    var retrieveRecordStatusAddr = serverAddr + '/retrieve/snapshot/connection'

    var today = new Date();
    var date = new Date();
    var selectedDate = new Date();

    var colorTable = ['#8E44AD', '#3498DB', '#16A085', '#F39C12', '#95A5A6', '#E74C3C', '#2ECC71', '#2980B9', '#F1C40F', '#34495E'];

    var monthString = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
    var monthArray = new Array();
    monthArray[0] = "January";
    monthArray[1] = "February";
    monthArray[2] = "March";
    monthArray[3] = "April";
    monthArray[4] = "May";
    monthArray[5] = "June";
    monthArray[6] = "July";
    monthArray[7] = "August";
    monthArray[8] = "September";
    monthArray[9] = "October";
    monthArray[10] = "November";
    monthArray[11] = "December";

    // example data
    var timeleapData = [
        {
            eventid: "1",
            date: "2021-10-04",
            title: "Event Test 1",
            snapshot: [
                { snapshotid: "1", timestamp: "2021-10-04 12:04:06", description: "Snapshot Test 1" },
                { snapshotid: "2", timestamp: "2021-10-04 12:04:06", description: "Snapshot Test 1" },
                { snapshotid: "3", timestamp: "2021-10-04 12:04:06", description: "Snapshot Test 1" },
                { snapshotid: "4", timestamp: "2021-10-04 12:04:06", description: "Snapshot Test 1" },
                { snapshotid: "5", timestamp: "2021-10-04 12:04:06", description: "Snapshot Test 1" },
            ]
        },

        {
            eventid: "2",
            date: "2021-10-13",
            title: "Event Test 2",
            snapshot: [
                { snapshotid: "21", timestamp: "2021-10-13 12:04:06", description: "Snapshot Test 2" },
                { snapshotid: "22", timestamp: "2021-10-13 12:04:06", description: "Snapshot Test 2" },
                { snapshotid: "23", timestamp: "2021-10-13 12:04:06", description: "Snapshot Test 2" },
                { snapshotid: "24", timestamp: "2021-10-13 12:04:06", description: "Snapshot Test 2" },
                { snapshotid: "25", timestamp: "2021-10-13 12:04:06", description: "Snapshot Test 2" },
            ]
        },

        {
            eventid: "3",
            date: "2021-10-26",
            title: "Event Test 3",
            snapshot: [
                { snapshotid: "101", timestamp: "2021-10-26 12:04:06", description: "Snapshot Test 3" },
                { snapshotid: "102", timestamp: "2021-10-26 12:04:06", description: "Snapshot Test 4" },
                { snapshotid: "103", timestamp: "2021-10-26 12:04:06", description: "Snapshot Test 5" },
                { snapshotid: "104", timestamp: "2021-10-26 12:04:06", description: "Snapshot Test 6" },
                { snapshotid: "105", timestamp: "2021-10-26 12:04:06", description: "Snapshot Test 7" },
            ]
        },

        {
            eventid: "4",
            date: "2021-11-09",
            title: "Event Test 4",
            snapshot: [
                { snapshotid: "31", timestamp: "2021-11-09 12:04:06", description: "Snapshot Test 3" },
                { snapshotid: "32", timestamp: "2021-11-09 12:04:06", description: "Snapshot Test 4" },
                { snapshotid: "33", timestamp: "2021-11-09 12:04:06", description: "Snapshot Test 5" },
                { snapshotid: "34", timestamp: "2021-11-09 12:04:06", description: "Snapshot Test 6" },
                { snapshotid: "35", timestamp: "2021-11-09 12:04:06", description: "Snapshot Test 7" },
            ]
        },

        {
            eventid: "5",
            date: "2021-11-18",
            title: "Event Test 5",
            snapshot: [
                { snapshotid: "36", timestamp: "2021-11-18 12:04:06", description: "Snapshot Test 3" },
                { snapshotid: "37", timestamp: "2021-11-18 12:04:06", description: "Snapshot Test 4" },
                { snapshotid: "38", timestamp: "2021-11-18 12:04:06", description: "Snapshot Test 5" },
                { snapshotid: "39", timestamp: "2021-11-18 12:04:06", description: "Snapshot Test 6" },
                { snapshotid: "40", timestamp: "2021-11-18 12:04:06", description: "Snapshot Test 7" },
            ]
        },
    ];

    var recordData = new Array();
    var snapshotListArray = new Array();
    var compareSnapshotList = new Array();
    var compareRecordList = new Array();
    var compareTableNameArray = new Array();
    var compareTableDataArray = new Array();
    var retrievedRecordArry = new Array();

    var connectedSVG = '<svg width="16" height="16"><rect x="3.5" y="0.5" width="9" height="9" style="fill:#22B573;stroke:#f2f2f2;"/><line y1="15.5" x2="16" y2="15.5" style="fill:none;stroke:#f2f2f2;"/><line x1="8" y1="15.5" x2="8" y2="9.5" style="fill:none;stroke:#f2f2f2"/></svg>'
    var disconnectedSVG = '<svg width="16" height="16"><rect x="3.5" y="0.5" width="9" height="9" style="fill:#D4145A;stroke:#f2f2f2;"/><line y1="15.5" x2="16" y2="15.5" style="fill:none;stroke:#f2f2f2;"/><line x1="8" y1="15.5" x2="8" y2="9.5" style="fill:none;stroke:#f2f2f2"/></svg>'
    var unmonitoredSVG = '<svg width="16" height="16"><rect x="3.5" y="0.5" width="9" height="9" style="fill:none;stroke:#f2f2f2;"/><line y1="15.5" x2="16" y2="15.5" style="fill:none;stroke:#f2f2f2;"/><line x1="8" y1="15.5" x2="8" y2="9.5" style="fill:none;stroke:#f2f2f2"/></svg>'

    // Clock
    function timer() {
        var d = new Date();
        document.getElementById('time-stamp').innerHTML = d.toLocaleTimeString('en-GB');
    }

    window.onload = function () {
        var myVar = setInterval(timer, 1000);

        // From Server
        getEventDataFromDB();

        // From Example Data
        // createCalendar(0);

        // Test Chart
        const labels = [
            'January',
            'February',
            'March',
            'April',
            'May',
            'June',
        ];

        const data = {
            labels: labels,
            datasets: [{
                label: 'My First dataset',
                // backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: [0, 10, 5, 2, 20, 30, 45],
            }]
        };

        const config = {
            type: 'line',
            data,
            options: {}
        };

        var compareChartContext = document.getElementById('compare-chart').getContext('2d');
        var myChart = new Chart(compareChartContext, config);
    }

    function createCalendar(offset) {

        // Remove this month schedule buttons
        var eventButtonClass = document.getElementsByClassName('scheduleButton');
        for (let i = eventButtonClass.length - 1; i >= 0; i--) {
            eventButtonClass[i].remove();
        }

        // Clear this month schedule list
        var bodyCenterId = document.getElementById('body-center');
        bodyCenterId.innerHTML = '';

        // Create selected month
        var thisDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth() + offset);
        selectedDate = thisDate;

        makeCalendar(thisDate);
        makeEventList(thisDate);

        // Create event and snapshot list
        // getEventDataFromDB(thisDate);
        // exampleData();
    }

    // function thisCalendar() {
    //     // Remove this month schedule buttons
    //     var eventButtonClass = document.getElementsByClassName('scheduleButton');
    //     for (let i = eventButtonClass.length - 1; i >= 0; i--) {
    //         eventButtonClass[i].remove();
    //     }

    //     // Clear this month schedule list
    //     var bodyCenterId = document.getElementById('body-center');
    //     bodyCenterId.innerHTML = '';

    //     // Create last month
    //     today = new Date(today.getFullYear(), today.getMonth());
    //     makeCalendar();

    //     // Create event and snapshot list
    //     // getEventDataFromDB();
    //     // exampleData();
    // }

    // function lastCalendar() {

    //     // Remove this month schedule buttons
    //     var eventButtonClass = document.getElementsByClassName('scheduleButton');
    //     for (let i = eventButtonClass.length - 1; i >= 0; i--) {
    //         eventButtonClass[i].remove();
    //     }

    //     // Clear this month schedule list
    //     var bodyCenterId = document.getElementById('body-center');
    //     bodyCenterId.innerHTML = '';

    //     // Create last month
    //     today = new Date(today.getFullYear(), today.getMonth() - 1);
    //     makeCalendar();

    //     // Create event list

    //     makeEventList();
    // }

    // function nextCalendar() {

    //     //getScheduleDatabase();

    //     // Remove this month schedule buttons
    //     var eventButtonClass = document.getElementsByClassName('scheduleButton');
    //     for (let i = eventButtonClass.length - 1; i >= 0; i--) {
    //         eventButtonClass[i].remove();
    //     }

    //     // Clear this month schedule list
    //     var bodyCenterId = document.getElementById('body-center');
    //     bodyCenterId.innerHTML = '';

    //     // Create next month
    //     today = new Date(today.getFullYear(), today.getMonth() + 1);
    //     makeCalendar();

    //     // Create event list
    //     makeEventList();
    // }

    function makeCalendar(referenceDate) {

        // Year and Month
        var yearId = document.getElementById("year");
        var month = monthArray[referenceDate.getMonth()];
        yearId.innerHTML = month + " " + referenceDate.getFullYear();

        var firstDate = new Date(referenceDate.getFullYear(), referenceDate.getMonth(), 1);
        var lastDate = new Date(referenceDate.getFullYear(), referenceDate.getMonth() + 1, 0);
        var prevMonthLastDate = new Date(referenceDate.getFullYear(), referenceDate.getMonth(), 0);

        var dayCalss = document.getElementsByClassName('day');
        var thisMonthFirstDay = firstDate.getDay();
        var day = prevMonthLastDate.getDate() - firstDate.getDay() + 1;


        // This Month
        for (let i = 0; i < dayCalss.length; i++) {
            var todayClass = dayCalss[i].getElementsByClassName('today')[0];

            // Last Month last day reset and start this month first day
            if (i == thisMonthFirstDay) {
                day = 1;
            }

            todayClass.innerHTML = day;

            // Sunday
            if (i % 7 == 0) {
                todayClass.style.color = "tomato";
            }

            // Today
            todayClass.style.backgroundColor = "transparent";
            if ((date.getFullYear() == referenceDate.getFullYear()) && (date.getMonth() == referenceDate.getMonth()) && (day == referenceDate.getDate())) {
                // todayClass.style.backgroundColor = "dodgerblue";
            }

            day += 1;

            // Last day reset and start next month first day
            if (day > lastDate.getDate()) {
                day = 1;
            }
        }
    }

    // function makeCalendar() {


    //     // Year and Month
    //     var yearId = document.getElementById("year");
    //     var month = monthArray[today.getMonth()];
    //     yearId.innerHTML = month + " " + today.getFullYear();

    //     var firstDate = new Date(today.getFullYear(), today.getMonth(), 1);
    //     var lastDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
    //     var prevMonthLastDate = new Date(today.getFullYear(), today.getMonth(), 0);

    //     var dayCalss = document.getElementsByClassName('day');
    //     var thisMonthFirstDay = firstDate.getDay();
    //     var day = prevMonthLastDate.getDate() - firstDate.getDay() + 1;


    //     // This Month
    //     for (let i = 0; i < dayCalss.length; i++) {
    //         var todayClass = dayCalss[i].getElementsByClassName('today')[0];

    //         // Last Month last day reset and start this month first day
    //         if (i == thisMonthFirstDay) {
    //             day = 1;
    //         }

    //         todayClass.innerHTML = day;

    //         // Sunday
    //         if (i % 7 == 0) {
    //             todayClass.style.color = "tomato";
    //         }

    //         // Today
    //         todayClass.style.backgroundColor = "transparent";
    //         if ((date.getFullYear() == today.getFullYear()) && (date.getMonth() == today.getMonth()) && (day == today.getDate())) {
    //             // todayClass.style.backgroundColor = "dodgerblue";
    //         }

    //         day += 1;

    //         // Last day reset and start next month first day
    //         if (day > lastDate.getDate()) {
    //             day = 1;
    //         }
    //     }
    // }

    function makeEventList(referenceDate) {
        var dayCalss = document.getElementsByClassName('day');
        var month = monthString[referenceDate.getMonth()];
        var year = referenceDate.getFullYear();
        var yearMonth = year + '-' + month;
        var listBoxDelay = 0.0;
        var listBoxColorIndex = 0;

        for (let i = 0; i < timeleapData.length; i++) {

            var startDate = new Date(timeleapData[i].date);
            var endDate = startDate;
            var days = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 3600 * 24)) + 1;

            var fromDateArray = timeleapData[i].date.split("-");
            var list = fromDateArray[0] + '-' + fromDateArray[1];

            // var toDateArray = scheduleList[i].toDate.split("-");
            // var list = toDateArray[0] + '-' + toDateArray[1];

            if (yearMonth == list) {

                var firstDate = new Date(referenceDate.getFullYear(), referenceDate.getMonth(), 1);
                var startIndex = firstDate.getDay() + parseInt(fromDateArray[2]) - 1;
                // var endIndex = parseInt(startIndex) + parseInt(scheduleList[i].days);
                var endIndex = parseInt(startIndex) + parseInt(days);

                // If schedule exceeds the last date of this month
                if (endIndex > dayCalss.length) {
                    endIndex = dayCalss.length;
                }

                createEventButton(startIndex);

                function createEventButton(index) {
                    var color = colorTable[listBoxColorIndex];
                    var scheduleButton = document.createElement('BUTTON');
                    var buttonText = document.createTextNode('Event ' + timeleapData[i].eventid);
                    scheduleButton.classList.add('scheduleButton');
                    // scheduleButton.addEventListener('click', function () { snapshotRecordList() });
                    scheduleButton.style.backgroundColor = color;
                    scheduleButton.style.height = '24px';

                    var buttonWidthScale = 1;
                    for (var j = index; j < endIndex; j++) {
                        // button head
                        if (j == startIndex) {
                            scheduleButton.style.borderTopLeftRadius = '12px';
                            scheduleButton.style.borderBottomLeftRadius = '12px';
                        }

                        // button tail
                        if (j == (endIndex - 1)) {
                            scheduleButton.style.borderTopRightRadius = '12px';
                            scheduleButton.style.borderBottomRightRadius = '12px';
                            scheduleButton.style.width = 100 * buttonWidthScale + 'px';
                            scheduleButton.appendChild(buttonText);
                            dayCalss[index].appendChild(scheduleButton);
                            break;
                        }

                        // In case of end of week
                        if ((j + 1) % 7 == 0) {
                            scheduleButton.style.width = 100 * buttonWidthScale + 'px';
                            scheduleButton.appendChild(buttonText);
                            dayCalss[index].appendChild(scheduleButton);

                            // create new button for next week
                            createEventButton(j + 1);
                            break;
                        }

                        buttonWidthScale += 1;
                    }

                    // Create snapsnot list box and detail infomation
                    snashotDetail(i, listBoxDelay, color);
                    listBoxDelay += 0.2;
                    listBoxColorIndex += 1;
                }
            }
        }
    }

    // function makeEventList() {
    //     var dayCalss = document.getElementsByClassName('day');
    //     var month = monthString[today.getMonth()];
    //     var year = today.getFullYear();
    //     var yearMonth = year + '-' + month;
    //     var listBoxDelay = 0.0;
    //     var listBoxColorIndex = 0;

    //     for (let i = 0; i < timeleapData.length; i++) {

    //         var startDate = new Date(timeleapData[i].date);
    //         var endDate = startDate;
    //         var days = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 3600 * 24)) + 1;

    //         var fromDateArray = timeleapData[i].date.split("-");
    //         var list = fromDateArray[0] + '-' + fromDateArray[1];

    //         // var toDateArray = scheduleList[i].toDate.split("-");
    //         // var list = toDateArray[0] + '-' + toDateArray[1];

    //         if (yearMonth == list) {

    //             var firstDate = new Date(today.getFullYear(), today.getMonth(), 1);
    //             var startIndex = firstDate.getDay() + parseInt(fromDateArray[2]) - 1;
    //             // var endIndex = parseInt(startIndex) + parseInt(scheduleList[i].days);
    //             var endIndex = parseInt(startIndex) + parseInt(days);

    //             // If schedule exceeds the last date of this month
    //             if (endIndex > dayCalss.length) {
    //                 endIndex = dayCalss.length;
    //             }

    //             createEventButton(startIndex);

    //             function createEventButton(index) {
    //                 var color = colorTable[listBoxColorIndex];
    //                 var scheduleButton = document.createElement('BUTTON');
    //                 var buttonText = document.createTextNode('Event ' + timeleapData[i].eventid);
    //                 scheduleButton.classList.add('scheduleButton');
    //                 // scheduleButton.addEventListener('click', function () { snapshotRecordList() });
    //                 scheduleButton.style.backgroundColor = color;
    //                 scheduleButton.style.height = '24px';

    //                 var buttonWidthScale = 1;
    //                 for (var j = index; j < endIndex; j++) {
    //                     // button head
    //                     if (j == startIndex) {
    //                         scheduleButton.style.borderTopLeftRadius = '12px';
    //                         scheduleButton.style.borderBottomLeftRadius = '12px';
    //                     }

    //                     // button tail
    //                     if (j == (endIndex - 1)) {
    //                         scheduleButton.style.borderTopRightRadius = '12px';
    //                         scheduleButton.style.borderBottomRightRadius = '12px';
    //                         scheduleButton.style.width = 100 * buttonWidthScale + 'px';
    //                         scheduleButton.appendChild(buttonText);
    //                         dayCalss[index].appendChild(scheduleButton);
    //                         break;
    //                     }

    //                     // In case of end of week
    //                     if ((j + 1) % 7 == 0) {
    //                         scheduleButton.style.width = 100 * buttonWidthScale + 'px';
    //                         scheduleButton.appendChild(buttonText);
    //                         dayCalss[index].appendChild(scheduleButton);

    //                         // create new button for next week
    //                         createEventButton(j + 1);
    //                         break;
    //                     }

    //                     buttonWidthScale += 1;
    //                 }

    //                 // Create snapsnot list box and detail infomation
    //                 snashotDetail(i, listBoxDelay, color);
    //                 listBoxDelay += 0.2;
    //                 listBoxColorIndex += 1;
    //             }
    //         }
    //     }
    // }

    function snashotDetail(index, delay, color) {

        var bodyCenterId = document.getElementById('body-center');
        let i = index;
        var height = 0;
        var heightLineCount = 1;

        var fromDateArray = timeleapData[i].date.split("-");
        var beginDay = parseInt(fromDateArray[2]);

        var toDateArray = fromDateArray;
        var endDay = parseInt(toDateArray[2]);

        var scheduleBox = document.createElement('DIV');
        scheduleBox.classList.add('schedule-list-box');
        scheduleBox.style.setProperty('--listBoxDelay', delay + 's');

        scheduleBox.style.backgroundColor = color;

        var scheduleBegin = document.createElement('DIV');
        scheduleBegin.classList.add('schedule-day-begin');
        scheduleBegin.innerText = timeleapData[i].eventid;


        // var scheduleEnd = document.createElement('DIV');
        // scheduleEnd.classList.add('schedule-day-end');
        // scheduleEnd.innerText = -(endDay);

        var scheduleTitle = document.createElement('DIV');
        scheduleTitle.classList.add('schedule-day-title');
        scheduleTitle.innerText = timeleapData[i].title;

        var newSnapshotButton = document.createElement('DIV');
        newSnapshotButton.classList.add('snapshot-new-button');
        newSnapshotButton.addEventListener('click', function () { setNewSnapshot(i) }); // Create new snapshot into selected event
        newSnapshotButton.innerText = '+';

        scheduleBox.appendChild(scheduleBegin);
        // scheduleBox.appendChild(scheduleEnd);
        scheduleBox.appendChild(scheduleTitle);
        scheduleBox.appendChild(newSnapshotButton);

        var snapshotTable = document.createElement('TABLE');
        snapshotTable.setAttribute('class', 'snapshot-list-table');

        for (let j = 0; j < timeleapData[i].snapshot.length; j++) {
            let snapshotID = timeleapData[i].snapshot[j].snapshotid;

            var row = snapshotTable.insertRow(-1);
            var idCell = row.insertCell(0);
            var descriptionCell = row.insertCell(1);

            idCell.innerText = snapshotID
            descriptionCell.innerText = timeleapData[i].snapshot[j].description;
            descriptionCell.addEventListener('click', function () { createSnapshotRecordTable(snapshotID) }) // Create recored list table which selected snapshot

            if (heightLineCount > 3) {
                height = 3 * 20;
            }
            else {
                height = heightLineCount * 20;
            }

            heightLineCount += 1;
        }

        scheduleBox.appendChild(snapshotTable);

        scheduleBox.style.setProperty('--listBoxHeight', 50 + height + 'px');
        scheduleBox.style.setProperty('--listBoxHeightExpand', 38 + heightLineCount * 20 + 'px');

        bodyCenterId.appendChild(scheduleBox);
    }

    function snapshotRecordList(snapshotID) {
        document.getElementById('snapshot-id').innerText = 'Snapshot ' + snapshotID;

        if (recordData.length) {
            let tHead = '';
            tHead += `<tr>
						<th>PV Name</th>
						<th>Value</th>
						<th>Status</th>
						<th>Not Restore</th>
						</tr>`

            document.getElementById("record-tableHead").innerHTML = tHead;

            let tData = '';
            for (let i = 0; i < recordData.length; i++) {
                var statusSVG = unmonitoredSVG;
                // consoel.log(statusSVG);
                switch (recordData[i].status) {
                    case 'true':
                        statusSVG = connectedSVG;
                        break;
                    case 'fasle':
                        statusSVG = disconnectedSVG;
                    default:
                        break;
                }

                tData += `<tr>
						<td>${recordData[i].pvname}</td>
						<td>${recordData[i].value}</td>
						<td>${statusSVG}</td>
						<td>OK</td>
						</tr>`
            }

            document.getElementById("record-tableBody").innerHTML = tData;
            $("#record-table tr").hide();
            $("#record-table tr").each(function (index) {
                $(this).delay(index * 20).show(300);
            });
        }
    }


    ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////
    ///////// Snapshot Record List Button Function ////////
    ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////

    function putSnapshotRecord() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                // console.log(this.responseText);
            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };

        xhttp.open("POST", putRecordAddr, true);
        xhttp.setRequestHeader('Content-Type', 'application/json');
        xhttp.send(JSON.stringify(recordData));
        // console.log(recordData);
    }

    function importRecordFile() {
        var input = document.createElement("input");
        input.type = "file";
        input.accept = "text/plain";
        input.onchange = function (event) {

            var reader = new FileReader();
            reader.onload = function () {
                var lines = reader.result.split('\n');
                var dataArray = new Array();

                for (let x of lines) {
                    var data = x.split(',');
                    var dataDic = { pvname: data[0], value: data[1], status: 'false' };

                    dataArray.push(dataDic);
                }

                recordData = dataArray;

                reloadSnapshotRecordData();
            };

            reader.readAsText(event.target.files[0], "euc-kr");
        };

        input.click();
    }

    function exportRecordFile() {
        var dataArray = [];
        for (let x of recordData) {
            var dataString = x.pvname + ',' + x.value;
            dataArray.push(dataString);
        }


        var filename = document.getElementById('snapshot-id').innerText;
        filename = filename.toLowerCase() + '.csv';

        var dataMergyString = dataArray.join('\r\n');

        // save('test.html', dataMergyString);

        var downloadElem = document.createElement('a');
        downloadElem.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(dataMergyString));
        downloadElem.setAttribute('download', filename);
        // el.style.display = 'none';
        document.body.appendChild(downloadElem);
        downloadElem.click();
        document.body.removeChild(downloadElem);
    }

    function reloadSnapshotRecordData() {

        let tData = '';
        for (let i = 0; i < recordData.length; i++) {
            var statusSVG = unmonitoredSVG;

            switch (recordData[i].status) {
                case 'true':
                    statusSVG = connectedSVG;
                    break;
                case 'fasle':
                    statusSVG = disconnectedSVG;
                default:
                    break;
            }

            tData += `<tr>
                <td>${recordData[i].pvname}</td>
                <td>${recordData[i].value}</td>
                <td>${statusSVG}</td>
                <td>OK</td>
                </tr>`
        }

        document.getElementById("record-tableBody").innerHTML = tData;
        $("#record-table tr").hide();
        $("#record-table tr").each(function (index) {
            $(this).delay(index * 20).show(300);
        });
    }

    ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////
    ///////////// Create New Snapshot Function ////////////
    ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////

    function createNewEventSet() {
        // var eventTitle = document.getElementById('new-event-title').value;
        // var snapshotDescription = document.getElementById('new-snapshot-description').value;

        eventData.title = 'New Event';
        eventData.description = 'New Snapshot';

        setNewTimeleap();
    }

    function setNewTimeleap() {

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };

        xhttp.open("POST", newEventAddr, true);
        xhttp.setRequestHeader('Content-Type', 'application/json');
        xhttp.send(JSON.stringify(eventData));
    }

    function setNewSnapshot(index) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var jsonValue = JSON.parse(this.responseText);

                var snapshotTable = document.getElementsByClassName('snapshot-list-table')[index];
                var row = snapshotTable.insertRow(0);
                var idCell = row.insertCell(0);
                var descriptionCell = row.insertCell(1);

                idCell.innerText = jsonValue.snapshotid;
                descriptionCell.innerText = 'New Snapshot';

                var listBox = snapshotTable.parentElement;
                var listBoxHeight = listBox.offsetHeight;

                listBox.style.setProperty('--listBoxHeightExpand', listBoxHeight + 3 + 'px');
                descriptionCell.addEventListener('click', function () { snapshotRecordList(jsonValue.snapshotid) })
            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };

        var snapshotData = { eventid: timeleapData[index].eventid, description: "New Snapshot" };

        xhttp.open("POST", newSnapshotAddr, true);
        xhttp.setRequestHeader('Content-Type', 'application/json');
        xhttp.send(JSON.stringify(snapshotData));
    }

    function getEventDataFromDB() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var jsonValue = JSON.parse(this.responseText);
                timeleapData = jsonValue;

                // Show compare button
                document.getElementById('event-button-container').style.visibility = 'visible';

                createCalendar(0);

                // Create event list
                // makeEventList(referenceDate);

            }
            // else {
            //     console.log(this.readyState, this.status);
            // }
        };

        var rName = retrieveAddr;
        xhttp.open("GET", rName, true);
        xhttp.send();
    }

    function getEvent() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };

        var rName = retrieveEventAddr;
        xhttp.open("GET", rName, true);
        xhttp.send();
    }

    function createSnapshotRecordTable(snapshotRecordID) {

        // Hide Compare Snapshot Table
        document.getElementById('compare-table').style.display = "none";

        // Stop Record List Table Update and Hide Table, Config Button
        document.getElementById('record-table').style.display = "table";
        document.getElementById('record-table-button').style.visibility = 'visible';

        getSnapshotRecord(snapshotRecordID);
    }

    function getSnapshotRecord(snapshotRecordID) {

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var jsonValue = JSON.parse(this.responseText);
                recordData = jsonValue;

                makeSnapshotRecordTable(snapshotRecordID, jsonValue);
                setRecordConnection(snapshotRecordID);

            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };

        var rName = retrieveSnapshotRecordAddr + '/' + snapshotRecordID;
        xhttp.open("GET", rName, true);
        xhttp.send();
    }

    function makeSnapshotRecordTable(snapshotID, recordData) {
        document.getElementById('snapshot-id').innerText = 'Snapshot ' + snapshotID;

        var buttonGroupID = document.getElementById('record-table-button');
        buttonGroupID.style.visibility = 'visible';

        if (recordData.length) {
            let tHead = '';
            tHead += `<tr>
                <th>PV Name</th>
                <th>Value</th>
                <th>Status</th>
                <th>Restore</th>
            </tr>`

            document.getElementById("record-tableHead").innerHTML = tHead;

            let tData = '';
            for (let i = 0; i < recordData.length; i++) {
                var statusSVG = unmonitoredSVG;

                switch (recordData[i].status) {
                    case 'true':
                        statusSVG = connectedSVG;
                        break;
                    case 'fasle':
                        statusSVG = disconnectedSVG;
                    default:
                        break;
                }

                recordData[i].restore = true;
                var restoreCheckHTML = '<input class="restoreCheckBox" type="checkbox" checked onclick="restoreCheck(' + i + ')">';

                tData += `<tr>
                    <td>${recordData[i].pvname}</td>
                    <td>${recordData[i].value}</td>
                    <td>${statusSVG}</td>
                    <td>${restoreCheckHTML}</td>
                </tr>`
            }

            document.getElementById("record-tableBody").innerHTML = tData;
            $("#record-table tr").hide();
            $("#record-table tr").each(function (index) {
                $(this).delay(index * 20).show(300);
            });
        }
    }

    var recordConnectionIntervalID = null;

    function setRecordConnection(snapshotRecordID) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

                clearInterval(recordConnectionIntervalID);
                recordConnectionIntervalID = setInterval(monitoringRecordConnection, 3000, snapshotRecordID);
            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };

        var rName = newRecordConnectionAddr + '/' + snapshotRecordID;
        xhttp.open("POST", rName, true);
        xhttp.setRequestHeader('Content-Type', 'application/json');
        xhttp.send(JSON.stringify(recordData));
    }

    function monitoringRecordConnection(snapshotRecordID) {

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var jsonValue = JSON.parse(this.responseText);

                for (let i = 0; i < recordData.length; i++) {
                    let name = recordData[i].pvname;
                    recordData[i].status = jsonValue[name];

                    // console.log(recordData[i].pvname);
                }

                // console.log(recordData);

                let tData = '';
                for (let i = 0; i < recordData.length; i++) {
                    var statusSVG = unmonitoredSVG;

                    switch (recordData[i].status) {
                        case true:
                            statusSVG = connectedSVG;
                            break;
                        case false:
                            statusSVG = disconnectedSVG;
                        default:
                            break;
                    }

                    var restoreCheckHTML = null;
                    switch (recordData[i].restore) {
                        case true:
                            restoreCheckHTML = '<input class="restoreCheckBox" type="checkbox" checked onclick="restoreCheck(' + i + ')">';
                            break;

                        case false:
                            restoreCheckHTML = '<input class="restoreCheckBox" type="checkbox" onclick="restoreCheck(' + i + ')">';
                            break;

                        default:
                            break;
                    }

                    tData += `<tr>
                                <td>${recordData[i].pvname}</td>
                                <td>${recordData[i].value}</td>
                                <td>${statusSVG}</td>
                                <td>${restoreCheckHTML}</td>
                            </tr>`
                }

                document.getElementById("record-tableBody").innerHTML = tData;
                // $("#record-table tr").hide();
                // $("#record-table tr").each(function (index) {
                //     $(this).delay(index * 0).show(0);
                // });
                // console.log(recordData);

            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };

        var rName = retrieveRecordStatusAddr + '/' + snapshotRecordID;
        xhttp.open("GET", rName, true);
        xhttp.send();
    }


    function updateSnapshotRecord() {

    }

    function applySnapshotRecord() {

    }

    function restoreCheck(index) {
        var checkBoxClass = document.getElementsByClassName('restoreCheckBox');
        recordData[index].restore = checkBoxClass[index].checked;
        consoel.log(index);
    }

    // 
    // 
    // 
    // 
    // 

    function compareCheck(index) {
        let id = snapshotListArray[index].snapshotid;
        let idIndex = compareSnapshotList.indexOf(id);

        if (idIndex == -1) {
            compareSnapshotList.push(id);
        }
        else {
            compareSnapshotList.splice(idIndex, 1);
        }
    }

    var SelectedCompareCount = 0;

    function compareSnapshot() {
        // Close Snapshot List Table
        document.getElementById('snapshot-list-body').style.display = 'none';

        // Stop Record List Table Update and Hide Table, Config Button
        clearInterval(recordConnectionIntervalID);
        document.getElementById('record-table').style.display = "none";
        document.getElementById('record-table-button').style.visibility = 'hidden';

        // Show Compare Snapshot Table
        document.getElementById('compare-table').style.display = "table";

        // Numeric Sort checked snapshot list
        compareSnapshotList.sort(function (a, b) {
            return a - b;
        });

        SelectedCompareCount = 0;
        if (compareSnapshotList.length != 0) {
            compareRecordList = [];
            compareTableNameArray = [];
            compareTableDataArray = [];
            retrievedRecordArry = [];

            getSnapshotRecordComapre(compareSnapshotList[SelectedCompareCount]);
        }

    }

    function getSnapshotRecordComapre(snapshotID) {

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var jsonValue = JSON.parse(this.responseText);
                // compareRecordList.push(jsonValue);
                retrievedRecordArry.push(jsonValue);

                for (let i = 0; i < jsonValue.length; i++) {
                    let name = jsonValue[i].pvname;
                    let index = compareTableNameArray.indexOf(name);

                    if (index == -1) {
                        compareTableNameArray.push(name);
                    }
                }

                SelectedCompareCount += 1;

                if (SelectedCompareCount < compareSnapshotList.length) {
                    getSnapshotRecordComapre(compareSnapshotList[SelectedCompareCount]);
                }
                else {
                    createComapreTable();
                }

            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };
        // console.log(snapshotID);

        var rName = retrieveSnapshotRecordAddr + '/' + snapshotID;
        xhttp.open("GET", rName, true);
        xhttp.send();
    }

    function createComapreTable() {

        for (let i = 0; i < compareTableNameArray.length; i++) {
            const name = compareTableNameArray[i];

            let valueList = [];

            for (let k = 0; k < retrievedRecordArry.length; k++) {

                let value = '';

                for (let x = 0; x < retrievedRecordArry[k].length; x++) {
                    const pvname = retrievedRecordArry[k][x].pvname;

                    if (name == pvname) {
                        value = retrievedRecordArry[k][x].value;
                        break;
                    }
                }

                valueList.push(value);
            }

            let rowData = { 'pvname': name, values: valueList };
            compareTableDataArray.push(rowData);
        }

        if (compareTableDataArray.length) {
            let tHead = '';
            tHead += "<tr><th>Name</th>";

            for (let i = 0; i < compareSnapshotList.length; i++) {
                tHead += `<th>Sanpshot ${compareSnapshotList[i]}`;
            }

            tHead += "</tr>";

            document.getElementById("compare-tableHead").innerHTML = tHead;

            let tData = '<tr>';
            for (let i = 0; i < compareTableDataArray.length; i++) {

                tData += `<td>${compareTableDataArray[i].pvname}</td>`;

                for (let k = 0; k < compareSnapshotList.length; k++) {
                    tData += `<td>${compareTableDataArray[i].values[k]}</td>`;
                }

                tData += "</tr>";
            }

            document.getElementById("compare-tableBody").innerHTML = tData;
            $("compare-table tr").hide();
            $("compare-table tr").each(function (index) {
                $(this).delay(index * 0).show(500);
            });
        }
    }

    function showSnapshotCompareTable() {

        // Reset Compare Snapshot List
        compareSnapshotList = [];

        getSnapshotListFromDB();
        // document.getElementById('snapshot-list-body').style.display = 'block';
        // document.getElementById('snapshot-list-body').style.transition = 'all 1s';
        // document.getElementById('snapshot-list-body').style.backdropFilter = 'blur(5px)';

        var snapshotListBodyID = document.getElementById('snapshot-list-body');

        // document.getElementById('face').style.transition = 'all 1s';
        // document.getElementById('face').style.backdropFilter = 'blur(10px)';
        var blurValue = 0.0;
        var opacity = 0.0;
        var id = setInterval(function () {

            if (blurValue > 5) {
                clearInterval(id);
            }

            snapshotListBodyID.style.backdropFilter = 'blur(' + blurValue + 'px)';
            snapshotListBodyID.style.background = 'rgba(255,255,255,' + opacity + ')';
            blurValue += 0.5;
            opacity += 0.01;

        }, 20);

        snapshotListBodyID.style.display = 'block';
    }

    function getSnapshotListFromDB() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var jsonValue = JSON.parse(this.responseText);
                snapshotListArray = jsonValue;

                if (jsonValue.length) {
                    let tHead = '';
                    tHead += `<tr>
						<th>Snapshot</th>
						<th>Description</th>
						<th>Timestamp</th>
						<th>Compare</th>
						</tr>`

                    document.getElementById("snapshot-compare-tableHead").innerHTML = tHead;

                    let tData = '';
                    for (let i = 0; i < jsonValue.length; i++) {

                        var compareCheckHTML = '<input class="compareCheckBox" type="checkbox" onclick="compareCheck(' + i + ')">';

                        tData += `<tr>
						<td>${jsonValue[i].snapshotid}</td>
						<td>${jsonValue[i].description}</td>
						<td>${jsonValue[i].timestamp}</td>
						<td>${compareCheckHTML}</td>
						</tr>`
                    }

                    document.getElementById("snapshot-compare-tableBody").innerHTML = tData;
                    // $("table tr").hide();
                    // $("table tr").each(function (index) {
                    //     $(this).delay(index * 0).show(500);
                    // });
                }
                else {

                }
            }
            // else {
            // alert('Status Error : ' + this.status);
            // }
        };

        var rName = retrieveSnapshotAddr;
        xhttp.open("GET", rName, true);
        xhttp.send();
    }


    // Example
    function exampleData() {
        // timeleapData = jsonValue;

        // Show Button
        document.getElementById('event-button-container').style.visibility = 'visible';

        // Create event list
        makeEventList();
    }
</script>

</html>