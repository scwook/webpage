<!DOCTYPE html>
<html>
<style>
    body {
        background-color: black;
    }

    .doughnut-contain {
        position: relative;
        width: 174px;
        height: 174px;
        transform: rotate(-90deg);
        margin: auto;
    }

    .doughnutBackground {
        stroke-dashoffset: 0;
        stroke: rgba(0, 84, 188, 0.3);
        transform: translate(7px, 7px);
        stroke-width: 14;
    }

    /* .doughnutForeground {
        animation-name: percentage;
        animation-duration: 0.5s;
    } */

    #storage-chart {
        stroke: var(--doughuntColor);
        stroke-width: 14;
        stroke-linecap: round;
        stroke-dasharray: 503;
        stroke-dashoffset: 503;
        transform: translate(7px, 7px);
        /* animation-timing-function: ease-out;
        animation-fill-mode: forwards; */
    }

    /* @keyframes percentage {
        from {
            stroke-dashoffset: var(--chartInit);
        }

        to {
            stroke-dashoffset: var(--chartValue);
        }
    } */
</style>

<body>
    <div class="doughnut-contain">
        <svg width="176" height="176" style="fill:none">
            <circle class="doughnutBackground" cx="80" cy="80" r="80" />
            <circle id="storage-chart" class="doughnutForeground" cx="80" cy="80" r="80"
                style="--doughuntColor:#00ace6; --chartValue:100; --chartInit:503" />
        </svg>
    </div>
</body>
<script>
    var intervalID;

    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            // tab is now inactive
            // temporarily clear timer using clearInterval() / clearTimeout()
            clearInterval(intervalID);
            console.log('inactive');
            

        }
        else {
            // tab is active again
            // restart timers
            intervalID = setInterval(sim, 5000);

            console.log('active');
        }
    });


    window.onload = function () {
        var chartMaxLength = 503;
        var storageChartID = document.getElementById('storage-chart');
        storageChartID.style.strokeDashoffset = '503';

        intervalID = setInterval(sim, 5000);
        // sim();
        // sim(dir, valueToOffset);
    }

    function sim() {
        var chartMaxLength = 503;
        var storageChartID = document.getElementById('storage-chart');

        // Storage
        var storageRealMaxValue = 100;
        var storageRealValue = Math.random() * storageRealMaxValue;

        var valueToOffset = Math.floor(chartMaxLength - chartMaxLength / storageRealMaxValue * storageRealValue);


        var storageChartID = document.getElementById('storage-chart');
        var currentDashOffset = parseInt(storageChartID.style.strokeDashoffset);
        var sign = valueToOffset - currentDashOffset;

        var dir = 0;
        if (sign > 0) {
            dir = -1; // anitclockwise, increase offset value
        } else if (sign < 0) {
            dir = 1; // clockwise, decrease offset value
        }

        if (dir == 0) {
            return;
        }

        var duration = 2000;
        var interval = 10;
        var count = 0;
        var maxCount = Math.floor(duration / interval);
        var x1 = 0.0;
        var x2 = 1.0;
        var dx = Math.abs(x1 - x2) / maxCount;
        var x = 0.0;
        var y = 0;
        var y1 = (dir == 1) ? valueToOffset : currentDashOffset;
        var y2 = (dir == 1) ? currentDashOffset : valueToOffset;
        var a = Math.abs(currentDashOffset - valueToOffset);
        var b = y1;

        var id = setInterval(function () {

            switch (dir) {
                case 1:
                    y = a * Math.pow(2, -10 * x) + y1;
                    break;

                case -1:
                    y = a * (1 - Math.pow(2, -10 * x)) + y1;

                    break;

                default:
                    count = maxCount; // 
            }

            storageChartID.style.strokeDashoffset = Math.floor(y);

            x += dx;
            count += 1;

            if (count == maxCount) {
                clearInterval(id);
            }

        }, interval);

    }

    function easeIncrease() {
        // increase function : y = a * {1 - [2^-(10*x)]} + b
        var y = pow(2, -10 * x) + b;
    }

    function easeDecrease() {
        // decrease function : y = a * [2^-(10*x)] + b
    }
</script>

</html>

<!-- Math.pow(2, -10 * dt1) -->