<!DOCTYPE html>
<html>
<!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
<link rel="stylesheet" type="text/css" href="monitoring.css">

<script src="script/moment.js"></script>
<script src="script/chart.js@2.8.0"></script>
<script src="script/chartjs-plugin-streaming.js"></script>
<script src="script/common.js"></script>

<body>
    <div style="margin:auto; position: relative; width:1920px; height:80px;">
        <div id="time-stamp"></div>
        <svg id="under-line" width="1920" height="42">
            <style>
                .under-line-style {
                    fill: none;
                    stroke: #f3f3f3;
                    stroke-miterlimit: 10;
                    stroke-width: 2px;
                }
            </style>
            <polyline class="under-line-style" points="0 40 760 40 791 0" />
            <polyline class="under-line-style" points="1920 40 1160 40 1129 0" />
        </svg>
        <svg id="center-top" width="400" height="80">
            <path
                d="M12.5,0H0L57,76a10,10,0,0,0,8,4H335a10,10,0,0,0,8-4L400,0H387.5L338,66a10,10,0,0,1-8,4H70a10,10,0,0,1-8-4Z"
                style="fill:#f3f3f3" />
        </svg>
        <div id="raon-box"><a href="main.html"><img src="images/raon-white.svg"></img></a></div>
		<div id="accelerator-control"><a href="members.html">Accelerator Control</a></div>
        <div id="menu">
            <a href="monitoring.html">Monitoring</a>
            <a href="schedule.html">Schedule</a>
            <a href="archive.html">Archive</a>
            <a href="downloads.html">Download</a>
            <a href="documents.html">Document</a>
        </div>
    </div>

    <div style="height:20px"></div>

    <div class="body-box">
        <button class="slide-button" onclick="showDivs(-1)">&#10094;</button>

        <div class="slide-box">
            <!-- Page 1 -->
            <div class="slide-page" style="display: block;">
                <div class="slide-page-title">Central Control</div>
                <div class="grid-container">

                    <div class="grid-item grid-1x1">
                        <p class="title">Storage</p>
                        <div class="doughnutChartText">80%</div>
                        <div class="doughnut-contain">
                            <svg width="176" height="176" style="fill:none">
                                <circle class="doughnutBackground" cx="80" cy="80" r="80" />
                                <circle class="doughnutForeground" cx="80" cy="80" r="80"
                                    style="--chartValue:100; --doughuntColor:#00ace6" />
                            </svg>
                        </div>
                    </div>

                    <div class="grid-item grid-1x1">
                        <p class="title">Archive</p>
                        <div class="doughnutChartText">293948</div>
                        <div class="doughnut-contain">
                            <svg width="174" height="174" style="fill:none">
                                <circle class="doughnutBackground" cx="80" cy="80" r="80" />
                                <circle class="doughnutForeground" cx="80" cy="80" r="80"
                                    style="--chartValue:100; --doughuntColor:#00e639" />
                            </svg>
                        </div>
                    </div>

                    <div class="grid-item grid-1x1">
                        <p class="title">Pressure
                            <span class="tooltiptext">SYS-SUBSYS:DEV-SUBDEV:Signal</span>
                        </p>
                        <p class="data" id="scwook-ai3">
                            <span id="pressure-value1">1.9</span><sup id="pressure-exp1" class="exp-value">-7</sup>
                        </p>
                    </div>

                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>

                    <div class="grid-item grid-3x2" style="grid-column: 1/span 3; grid-row: 2/span 2;"></div>

                    <div class="grid-item grid-2x1" style="grid-column: 4/span 2;">
                        <canvas id="canvas"></canvas>
                    </div>

                    <div class="grid-item grid-1x1">
                        <p class="title">LN2</p>
                        <div class="liquid-box"><span id="n2-value">45</span>
                            <div class="subBox" id="n2-flow" style="--b:rgba(0,180,170,1.0)"></div>
                        </div>
                    </div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                </div>
            </div>

            <!-- Page 2 -->
            <div class="slide-page" style="display: none">
                <div class="slide-page-title">Cryogenic</div>
                <div class="grid-container">
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                </div>
            </div>

            <!-- Page 3 -->
            <div class="slide-page" style="display: none">
                <div class="slide-page-title">Module</div>
                <div class="grid-container">
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                    <div class="grid-item grid-1x1"></div>
                </div>
            </div>
        </div>
        <button class="slide-button" onclick="showDivs(1)">&#10095;</button>

    </div>



</body>

<script>
    var subBox = document.getElementById('n2-flow');

    var rotationID = null;
    var rotationDegree = 0;

    function rotationStart() {
        clearInterval(rotationID);

        rotationID = setInterval(rotation, 10);
    }

    function rotationStop() {
        clearInterval(rotationID);
    }

    function rotation() {
        subBox.style.transform = 'rotate(' + rotationDegree + 'deg)';
        rotationDegree += 0.5;
    }

    var fillID = null;
    var topPosition = 176;

    function fillStart(setPosition) {
        clearInterval(fillID);

        if (setPosition > topPosition) {
            direction = 1; // empty

        }
        else if (setPosition < topPosition) {
            direction = -1 // fill
        }
        else {
            return;
        }

        fillID = setInterval(fill, 50, setPosition, direction); // fill
    }

    function fillStop() {
        clearInterval(fillID);
    }

    function fill(setPosition, direction) {

        if (topPosition == setPosition) {
            clearInterval(fillID);
        }

        topPosition += direction;
        subBox.style.top = topPosition + 'px';

        // console.log(topPosition);
    }

    function randomScalingFactor() {
        return (Math.random() > 0.5 ? 1.0 : -1.0) * Math.round(Math.random() * 100);
    }

    function onRefresh(chart) {
        chart.config.data.datasets.forEach(function (dataset) {
            dataset.data.push({
                x: Date.now(),
                y: randomScalingFactor()
            });
        });
    }

    // Line chart configuration
    function lineChartConfig(details) {
        // var color = Chart.helpers.color;
        return {
            type: 'line',
            data: {
                datasets: [{
                    label: details.label,
                    // backgroundColor: color(chartColors.blue).alpha(0.5).rgbString(),
                    borderColor: details.color,
                    fill: false,
                    cubicInterpolationMode: 'monotone',
                    data: [],
                }]
            },
            options: {
                title: {
                    display: true,
                    text: details.label
                },
                legend: {
                    display: false
                },
                layout: {
                    padding: {
                        bottom: 10
                    }
                },
                scales: {
                    xAxes: [{
                        type: 'realtime',
                        realtime: {
                            duration: 60000,
                            refresh: 1000,
                            delay: 2000,
                            onRefresh: onRefresh
                        },
                        gridLines: {
                            display: false
                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'value'
                        },
                        gridLines: {
                            display: false
                        }
                    }]
                },
                tooltips: {
                    mode: 'nearest',
                    intersect: false
                },
                hover: {
                    mode: 'nearest',
                    intersect: false
                }
            }
        };
    }

    function timer() {
        var d = new Date();
        document.getElementById('time-stamp').innerHTML = d.toLocaleTimeString('en-GB');
    }

    function monitoring() {
        var pvList = ["scwook-ai1", "scwook-ai2", "scwook-ai3"];
        requests = new Array(pvList.length);

        for (let i = 0; i < pvList.length; i++) {
            requests[i] = new XMLHttpRequest();
            requests[i].open("GET", pvList[i], true);

            requests[i].onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var jsonValue = JSON.parse(requests[i].responseText);
                    document.getElementById(pvList[i]).innerHTML = jsonValue.value;

                    alarmStatus = jsonValue.alarm.severity;
                    switch (alarmStatus) {
                        case 0:
                            document.getElementById(pvList[i]).style.color = "white";
                            break;

                        case 1:
                            document.getElementById(pvList[i]).style.color = "Gold";
                            break;

                        case 2:
                            document.getElementById(pvList[i]).style.color = "OrangeRed";
                            break;
                    }

                }
            }
            requests[i].send();
        }
    }

    // var count = 0;
    // function changeImage() {

    //     if (count == 0) {
    //         document.getElementById("img").src = "change.svg";
    //         count = 1;
    //     }
    //     else {
    //         document.getElementById("img").src = "image1.svg";
    //         count = 0;
    //     }
    // }

    var slideIndex = 1;

    function showDivs(count) {

        slideIndex += count;
        n = slideIndex;

        var i;
        var x = document.getElementsByClassName("slide-page");

        if (n > x.length) {
            slideIndex = 1
        }
        if (n < 1) {
            slideIndex = x.length
        }

        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
        }

        console.log(n);
        if (count < 0) {
            x[slideIndex - 1].style.position = "relative";
            x[slideIndex - 1].style.animation = "animateleft 0.4s";
            x[slideIndex - 1].style.display = "block";
        }
        else {
            x[slideIndex - 1].style.position = "relative";
            x[slideIndex - 1].style.animation = "animateright 0.4s";
            x[slideIndex - 1].style.display = "block";
        }

    }

    function timer() {
        var d = new Date();
        document.getElementById('time-stamp').innerHTML = d.toLocaleTimeString('en-GB');
    }

    window.onload = function () {
        firstShowUp();
        simulation();

        var details = [
            { label: "Line Chart1", color: window.chartColors.red }
        ]

        var ctx = document.getElementById('canvas').getContext('2d');
        window.myChart1 = new Chart(ctx, lineChartConfig(details[0]));

        var myVar = setInterval(timer, 1000);
    }

    function firstShowUp() {
        rotationStart();
        fillStart(80);
    }

    function simulation() {

        // Pressure
        var pressureValue1ID = document.getElementById('pressure-value1');
        setInterval(function () {
            var dataValue = (Math.random() * 10).toFixed(1);
            pressureValue1ID.innerText = dataValue;

        }, 3000);
    }
</script>

</html>